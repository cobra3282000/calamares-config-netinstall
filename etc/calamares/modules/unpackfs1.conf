# SPDX-FileCopyrightText: no
# SPDX-License-Identifier: CC0-1.0
#
# Net installer - Base system installation using pacstrap
# Installs base Arch system and all Xorg components

# Do not run in chroot - operates on the host system
dontChroot: true

# Pacstrap package list for base installation
pacstrap_packages:
    # Core system
    - base
    - base-devel
    - linux-firmware
    - mkinitcpio
    # Bootloader
    - grub
    - efibootmgr
    - os-prober
    # Note: Kernel (linux/linux-lts/linux-zen/etc.) is selected by user
    # in drivers.yaml and installed by netinstall@drivers module
    # Xorg display server
    - xorg-server
    - xorg-apps
    - xorg-xinit
    # Input drivers
    - xf86-input-libinput
    # Video drivers (all variants for hardware compatibility)
    - xf86-video-amdgpu
    - xf86-video-ati
    - xf86-video-intel
    - xf86-video-nouveau
    - xf86-video-vesa
    - xf86-video-fbdev
    - xf86-video-vmware

# Copy configuration files and directories from ISO to target system
unpack:
    # Copy kernel and initramfs images for boot
    - source: "/run/archiso/bootmnt/arch/boot/x86_64/vmlinuz-linux"
      sourcefs: "file"
      destination: "${ROOT}/boot/vmlinuz-linux"

    - source: "/run/archiso/bootmnt/arch/boot/x86_64/initramfs-linux.img"
      sourcefs: "file"
      destination: "${ROOT}/boot/initramfs-linux.img"

    - source: "/run/archiso/bootmnt/arch/boot/x86_64/initramfs-linux-fallback.img"
      sourcefs: "file"
      destination: "${ROOT}/boot/initramfs-linux-fallback.img"

    # Copy mkinitcpio configuration
    - source: "/etc/mkinitcpio.conf"
      sourcefs: "file"
      destination: "${ROOT}/etc/mkinitcpio.conf"

    - source: "/etc/mkinitcpio.d"
      sourcefs: "dir"
      destination: "${ROOT}/etc/mkinitcpio.d"

    # Copy configuration files
    - source: "/etc/archiso.conf"
      sourcefs: "file"
      destination: "${ROOT}/etc/archiso.conf"

    - source: "/etc/resolv.conf"
      sourcefs: "file"
      destination: "${ROOT}/etc/resolv.conf"

    - source: "/etc/resolve.conf"
      sourcefs: "file"
      destination: "${ROOT}/etc/resolve.conf"

    - source: "/etc/cinnamon-settings.dconf"
      sourcefs: "file"
      destination: "${ROOT}/etc/cinnamon-settings.dconf"

    # Copy configuration directories (recursive)
    - source: "/etc/cinnamon-configs"
      sourcefs: "dir"
      destination: "${ROOT}/etc/cinnamon-configs"

    - source: "/etc/terminal-settings"
      sourcefs: "dir"
      destination: "${ROOT}/etc/terminal-settings"

    - source: "/usr/share/backgrounds"
      sourcefs: "dir"
      destination: "${ROOT}/usr/share/backgrounds"
